<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Results • AI Data Dashboard Generator</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --brand:#635bff; }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 800px at 20% -10%, #1f2937, transparent),
                  radial-gradient(1000px 800px at 100% 0%, #0b1220, transparent),
                  var(--bg); color: var(--text);
    }
    .wrap { max-width: 880px; margin: 48px auto; padding: 0 20px; }
    h1 { margin-top: 0; }
    .card {
      background: linear-gradient(180deg, #0f172a, #0b1220);
      border: 1px solid #1f2937; border-radius: 16px; padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .row { display:flex; gap:12px; align-items:center; margin-top: 16px; flex-wrap: wrap; }
    button, .btn {
      background: var(--brand); color:#fff; border:0; border-radius:10px;
      padding: 10px 14px; font-size: 15px; cursor:pointer;
      transition: transform .06s ease, filter .2s ease;
    }
    button:hover, .btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
    a.btn { text-decoration: none; display:inline-block }
    .foot { margin-top: 22px; font-size: 12px; color: var(--muted); }
    code { background:#0b1220; padding:2px 6px; border-radius:6px; border:1px solid #1f2937 }
    .md { line-height:1.6 }
    .md h2, .md h3 { margin-top:1.1em }
    .md pre, .md code { background:#0b1220; border:1px solid #1f2937; border-radius:10px }
    .md pre { padding:12px; overflow:auto }
    .ghost { background:#1f2937; border:1px solid #334155; border-radius:8px; padding:6px 10px; color:#e5e7eb }
    .disabled { opacity:.6; cursor:not-allowed; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Your AI-Generated Suggestions</h1>

    <section class="card">
      <article id="rendered" class="md"></article>
      <pre id="plain" style="display:none">{{ output }}</pre>

      <div class="row">
        <a class="btn" href="{{ url_for('home') }}">← Analyze another CSV</a>
        <button id="copyAll" class="ghost" type="button" title="Copy all text">Copy All</button>

        <form action="{{ url_for('create_checkout_session') }}" method="POST" id="buyForm">
          {% if pro %}
            <button type="button" class="disabled" disabled>Already Upgraded</button>
          {% elif stripe_key %}
            <!-- Offer both subscription and credits here too -->
            <input type="hidden" name="plan" value="subscription" />
            <button type="submit" id="buyBtn">Subscribe – $29/mo</button>
          {% else %}
            <button type="button" class="disabled" disabled>Stripe not configured</button>
          {% endif %}
        </form>
      </div>
    </section>

    <div class="foot">
      {% if not pro %}
        Credits available: <code>{{ credits }}</code>
      {% else %}
        Unlimited access enabled.
      {% endif %}
      <br />Test with card <code>4242 4242 4242 4242</code>, any future date, any CVC, any ZIP.
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" crossorigin="anonymous"></script>
  <script>
    (function () {
      const md = {{ output|tojson }};
      const rendered = document.getElementById('rendered');
      const plain = document.getElementById('plain');
      try { rendered.innerHTML = marked.parse(md || ''); }
      catch (e) { plain.style.display = 'block'; }

      document.getElementById('copyAll').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(md || '');
          const b = document.getElementById('copyAll');
          const t = b.textContent; b.textContent = 'Copied!'; setTimeout(() => b.textContent = t, 1200);
        } catch (_) {}
      });

      const buyForm = document.getElementById('buyForm');
      const buyBtn  = document.getElementById('buyBtn');
      if (buyForm && buyBtn) {
        buyForm.addEventListener('submit', () => {
          buyBtn.disabled = true; buyBtn.classList.add('disabled');
          const t = buyBtn.textContent; buyBtn.textContent = 'Redirecting…';
          setTimeout(() => { buyBtn.textContent = t; buyBtn.disabled = false; buyBtn.classList.remove('disabled'); }, 8000);
        });
      }
    })();
  </script>
</body>
</html>
